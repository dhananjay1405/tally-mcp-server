<?xml version="1.0" encoding="utf-8"?>
<ENVELOPE>
    <HEADER>
        <VERSION>1</VERSION>
        <TALLYREQUEST>Export</TALLYREQUEST>
        <TYPE>Data</TYPE>
        <ID>MyTallyLiveReport</ID>
    </HEADER>
    <BODY>
        <DESC>
            <STATICVARIABLES>
                <SVEXPORTFORMAT>$$SysName:XML</SVEXPORTFORMAT>
				<SVFROMDATE>{fromDate}</SVFROMDATE>
                <SVTODATE>{toDate}</SVTODATE>
                <nunjuck>if targetCompany</nunjuck>
                <SVCURRENTCOMPANY>{{targetCompany | escape}}</SVCURRENTCOMPANY>
                <nunjuck>endif</nunjuck>
            </STATICVARIABLES>
            <TDL>
                <TDLMESSAGE>
                    <REPORT NAME="MyTallyLiveReport">
                        <FORMS>MyForm</FORMS>
                    </REPORT>
                    <FORM NAME="MyForm">
                        <PARTS>MyPartVoucher</PARTS>
                        <XMLTAG>DATA</XMLTAG>
                    </FORM>
					<PART NAME="MyPartVoucher">
						<LINES>MyLineVoucher</LINES>
						<REPEAT>MyLineVoucher : MyCollection</REPEAT>
						<SCROLLED>Vertical</SCROLLED>
					</PART>
					<PART NAME="MyPartLedgerEntry">
						<LINES>MyLineLedgerEntry</LINES>
						<REPEAT>MyLineLedgerEntry : AllLedgerEntries</REPEAT>
						<SCROLLED>Vertical</SCROLLED>
					</PART>
					<PART NAME="MyPartInventoryEntry">
						<LINES>MyLineInventoryEntry</LINES>
						<REPEAT>MyLineInventoryEntry : AllInventoryEntries</REPEAT>
						<SCROLLED>Vertical</SCROLLED>
					</PART>
					<LINE NAME="MyLineVoucher">
						<FIELDS>FldDate,FldVoucherTypeName,FldVoucherNumber,FldNarration</FIELDS>
						<EXPLODE>MyPartLedgerEntry</EXPLODE>
						<EXPLODE>MyPartInventoryEntry</EXPLODE>
                        <XMLTAG>row</XMLTAG>
					</LINE>
					<LINE NAME="MyLineLedgerEntry">
						<FIELDS>FldLedgerName,FldLedgerAmount</FIELDS>
                        <XMLTAG>F05.LIST</XMLTAG>
					</LINE>
					<LINE NAME="MyLineInventoryEntry">
						<FIELDS>FldItemName,FldItemQty,FldItemRate,FldItemAmount,FldItemGodown</FIELDS>
                        <XMLTAG>F06.LIST</XMLTAG>
					</LINE>
                    <FIELD NAME="FldDate">
						<SET>if $$IsEmpty:$Date then "" else $$PyrlYYYYMMDDFormat:$Date:"-"</SET>
						<XMLTAG>F01</XMLTAG>
					</FIELD>
					<FIELD NAME="FldVoucherTypeName">
						<SET>$VoucherTypeName</SET>
						<XMLTAG>F02</XMLTAG>
					</FIELD>
					<FIELD NAME="FldVoucherNumber">
						<SET>$VoucherNumber</SET>
						<XMLTAG>F03</XMLTAG>
					</FIELD>
					<FIELD NAME="FldNarration">
						<SET>$Narration</SET>
						<XMLTAG>F04</XMLTAG>
					</FIELD>
					<FIELD NAME="FldLedgerName">
						<SET>$LedgerName</SET>
						<XMLTAG>F01</XMLTAG>
					</FIELD>
					<FIELD NAME="FldLedgerAmount">
						<SET>$$StringFindAndReplace:(if $$IsDebit:$Amount then -$$NumValue:$Amount else $$NumValue:$Amount):"(-)":"-"</SET>
						<XMLTAG>F02</XMLTAG>
					</FIELD>
					<FIELD NAME="FldItemName">
						<SET>$StockItemName</SET>
						<XMLTAG>F01</XMLTAG>
					</FIELD>
					<FIELD NAME="FldItemQty">
						<SET>$$StringFindAndReplace:(if $$IsInwards:$BilledQty then $$Number:$$String:$BilledQty:"TailUnits" else -$$Number:$$String:$BilledQty:"TailUnits"):"(-)":"-"</SET>
						<XMLTAG>F02</XMLTAG>
					</FIELD>
					<FIELD NAME="FldItemRate">
						<SET>if $$IsEmpty:$Rate then 0 else $$Number:$Rate</SET>
						<XMLTAG>F03</XMLTAG>
					</FIELD>
					<FIELD NAME="FldItemAmount">
						<SET>$$StringFindAndReplace:(if $$IsDebit:$Amount then -$$NumValue:$Amount else $$NumValue:$Amount):"(-)":"-"</SET>
						<XMLTAG>F04</XMLTAG>
					</FIELD>
					<FIELD NAME="FldItemGodown">
						<SET>$GodownName</SET>
						<XMLTAG>F05</XMLTAG>
					</FIELD>
					<COLLECTION NAME="MyCollection">
						<TYPE>Voucher</TYPE>
						<FETCH>AllLedgerEntries,AllInventoryEntries</FETCH>
						<FILTER>FltrCancelled,FltrOptional,FltrVoucherType</FILTER>
					</COLLECTION>
					<SYSTEM TYPE="Formulae" NAME="FltrCancelled">NOT $IsCancelled</SYSTEM>
					<SYSTEM TYPE="Formulae" NAME="FltrOptional">NOT $IsOptional</SYSTEM>
					<nunjuck>set regExp = r/(sales?)/gi</nunjuck>
                    <nunjuck>if regExp.test('{nature}')</nunjuck>
					<SYSTEM TYPE="Formulae" NAME="FltrVoucherType">$Parent:VoucherType:$VoucherTypeName = "Sales"</SYSTEM>
					<nunjuck>else</nunjuck>
					<SYSTEM TYPE="Formulae" NAME="FltrVoucherType">$Parent:VoucherType:$VoucherTypeName = "Purchase"</SYSTEM>
					<nunjuck>endif</nunjuck>
                </TDLMESSAGE>
            </TDL>
        </DESC>
    </BODY>
</ENVELOPE>